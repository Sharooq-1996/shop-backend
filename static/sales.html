<!DOCTYPE html>
<html>
<head>
<title>Sales – Ayan Watch and Electronics</title>
<style>
body{font-family:Arial;background:#eef2f3;padding:20px;}
.container{max-width:1200px;margin:auto;background:white;padding:20px;border-radius:10px;}
.product-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;margin-bottom:20px;}
.product-item{border:1px solid #ddd;padding:15px;text-align:center;border-radius:10px;cursor:pointer;}
.product-item img{width:80px;height:80px;object-fit:contain;margin-bottom:10px;}
.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:10px;}
.form-grid input,.form-grid select{padding:8px;}
button{padding:6px 12px;border:none;cursor:pointer;}
.add-btn{background:#28a745;color:white;}
.print-btn{background:#007bff;color:white;}
.delete-btn{background:#dc3545;color:white;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
th,td{border:1px solid #ddd;padding:6px;text-align:center;}
th{background:#1f7ae0;color:white;}
.summary{display:flex;gap:20px;margin-top:10px;}
.box{flex:1;background:#f1f7ff;padding:10px;text-align:center;font-weight:bold;}
</style>
</head>
<body>

<div class="container">

<h2>Select Product</h2>

<div class="product-grid">
<div class="product-item" onclick="selectProduct('Gents Belt Watch')"><img src="gents-belt.png"><p>Gents Belt Watch</p></div>
<div class="product-item" onclick="selectProduct('Gents Chain Watch')"><img src="gents-chain.png"><p>Gents Chain Watch</p></div>
<div class="product-item" onclick="selectProduct('Ladies Belt Watch')"><img src="ladies-belt.png"><p>Ladies Belt Watch</p></div>
<div class="product-item" onclick="selectProduct('Ladies Chain Watch')"><img src="ladies-chain.png"><p>Ladies Chain Watch</p></div>
<div class="product-item" onclick="selectProduct('Wall Clock')"><img src="wall-clock.png"><p>Wall Clock</p></div>
<div class="product-item" onclick="selectProduct('Alarm Timepiece')"><img src="alarm.png"><p>Alarm Timepiece</p></div>
<div class="product-item" onclick="selectProduct('Strap')"><img src="straps.png"><p>Strap</p></div>
<div class="product-item" onclick="selectProduct('Chain')"><img src="chain.png"><p>Chain</p></div>
<div class="product-item" onclick="selectProduct('Repair')"><img src="repair.png"><p>Repair</p></div>
<div class="product-item" onclick="selectProduct('Watch Cell')"><img src="watch-cell.png"><p>Watch Cell</p></div>
<div class="product-item" onclick="selectProduct('Titan Cell')"><img src="TitanCells.png"><p>Titan Cell</p></div>
</div>

<h2>Selected Item</h2>

<div class="form-grid">
<input id="customerName" placeholder="Customer Name">
<input id="productName" readonly>

<select id="cellName"></select>
<select id="warranty">
<option value="">Select Warranty</option>
<option>3 Months</option>
<option>6 Months</option>
<option>1 Year</option>
</select>

<input id="quantity" type="number" value="1">
<input id="price" placeholder="Enter Price">

<select id="paymentMethod">
<option>CASH</option>
<option>UPI</option>
</select>
</div>

<button class="add-btn" onclick="addSale()">Add Sale</button>

<h2>Sales Report</h2>

<div class="summary">
<div class="box">Total Sales Count<br><span id="count">0</span></div>
<div class="box">Total Sales Amount ₹<br><span id="amount">0</span></div>
</div>

<table>
<thead>
<tr>
<th>ID</th><th>Customer</th><th>Product</th><th>Cell</th><th>Warranty</th>
<th>Qty</th><th>Price</th><th>Payment</th><th>Date & Time</th><th>Action</th>
</tr>
</thead>
<tbody id="salesBody"></tbody>
</table>

</div>

<script>

function selectProduct(name){
	productName.value=name;
	cellName.innerHTML="";
	
	if(name==="Watch Cell"){
		cellName.innerHTML=`<option>G1</option><option>626</option><option>521</option>
		<option>721</option><option>920</option><option>2016</option>
		<option>2025</option><option>2030</option><option>Others</option>`;
	}
	else if(name==="Titan Cell"){
		cellName.innerHTML=`<option>626</option><option>521</option>
		<option>721</option><option>920</option>`;
	}
}

async function addSale(){

	const sale={
		customerName:customerName.value,
		productName:productName.value,
		cellName:cellName.value||"",
		warranty:warranty.value||"",
		quantity:+quantity.value,
		price:+price.value,
		paymentMethod:paymentMethod.value
	};

	await fetch("/sales/create",{
		method:"POST",
		headers:{"Content-Type":"application/json"},
		body:JSON.stringify(sale)
	});

	loadSales();
}

async function deleteSale(id){
	await fetch("/sales/delete?id="+id);
	loadSales();
}

function formatIST(dateStr){
	return new Date(dateStr).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"});
}

async function loadSales(){

	const res=await fetch("/sales");
	const data=await res.json();

	let count=0, amount=0;
	salesBody.innerHTML="";

	data.forEach(s=>{
		count++;
		amount+=s.price*s.quantity;

		salesBody.innerHTML+=`
		<tr>
		<td>${s.saleId}</td>
		<td>${s.customerName}</td>
		<td>${s.productName}</td>
		<td>${s.cellName||""}</td>
		<td>${s.warranty||""}</td>
		<td>${s.quantity}</td>
		<td>₹${s.price}</td>
		<td>${s.paymentMethod}</td>
		<td>${formatIST(s.createdDate)}</td>
		<td>
			<button class="print-btn" onclick='printBill(${JSON.stringify(s)})'>Print</button>
			<button class="delete-btn" onclick="deleteSale(${s.saleId})">Delete</button>
		</td>
		</tr>`;
	});

	countSpan=document.getElementById("count");
	amountSpan=document.getElementById("amount");
	countSpan.innerText=count;
	amountSpan.innerText=amount;
}

function printBill(s){
	const win=window.open("","","width=300,height=500");
	win.document.write(`
	<h3>AYAN WATCH & ELECTRONICS</h3>
	<hr>
	Customer: ${s.customerName}<br>
	Product: ${s.productName}<br>
	Cell: ${s.cellName||""}<br>
	Warranty: ${s.warranty||""}<br>
	Qty: ${s.quantity}<br>
	Price: ₹${s.price}<br>
	Payment: ${s.paymentMethod}<br>
	Date: ${formatIST(s.createdDate)}
	<hr>
	Thank You
	`);
	win.document.close();
	win.print();
}

document.addEventListener("DOMContentLoaded",loadSales);

</script>

</body>
</html>
