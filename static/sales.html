<!DOCTYPE html>
<html>
<head>
<title>Sales – Ayan Watch and Electronics</title>
<style>
body{font-family:Arial;background:#eef2f3;padding:20px;}
.container{max-width:1200px;margin:auto;background:white;padding:20px;border-radius:10px;}
.product-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-bottom:20px;}
.product-item{border:1px solid #ddd;padding:15px;text-align:center;border-radius:10px;cursor:pointer;}
.product-item img{width:100px;height:100px;object-fit:contain;}
.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;}
input,select{padding:8px;}
.add-btn{padding:10px;background:#28a745;color:white;border:none;cursor:pointer;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ddd;padding:8px;text-align:center;}
th{background:#1f7ae0;color:white;}
.print-btn{background:#007bff;color:white;border:none;padding:5px 10px;}
.delete-btn{background:#dc3545;color:white;border:none;padding:5px 10px;}
.summary{display:flex;gap:20px;margin:20px 0;}
.box{flex:1;background:#f1f7ff;padding:20px;text-align:center;font-weight:bold;border-radius:10px;}
</style>
</head>
<body>

<div class="container">

<h2>Select Product</h2>
<div class="product-grid">
<div class="product-item" onclick="selectProduct('Watch Cell')"><img src="watch-cell.png"><p>Watch Cell</p></div>
<div class="product-item" onclick="selectProduct('Titan Cell')"><img src="TitanCells.png"><p>Titan Cell</p></div>
<div class="product-item" onclick="selectProduct('Wall Clock')"><img src="wall-clock.png"><p>Wall Clock</p></div>
</div>

<h2>Selected Item</h2>

<div class="form-grid">
<input id="customerName" placeholder="Customer Name">
<input id="productName" placeholder="Product" readonly>

<select id="cellSelect"><option value="">Select Cell</option></select>
<select id="warrantySelect">
<option value="">Select Warranty</option>
<option>3 Months</option>
<option>6 Months</option>
<option>1 Year</option>
</select>

<input id="quantity" type="number" value="1">
<input id="price" type="number" placeholder="Enter Price">

<select id="paymentMethod">
<option value="CASH">Cash</option>
<option value="UPI">UPI</option>
</select>

<input type="datetime-local" id="saleDate">

<button class="add-btn" onclick="addSale()">Add Sale</button>
</div>

<h2>Sales Report</h2>

Search Date:
<input type="date" id="searchDate">
<button onclick="searchByDate()">Search</button>
<button onclick="loadSales()">Today</button>

<div class="summary">
<div class="box">Total Sales Count<br><span id="count">0</span></div>
<div class="box">Total Sales Amount ₹<br><span id="amount">0</span></div>
</div>

<table>
<thead>
<tr>
<th>ID</th><th>Customer</th><th>Product</th><th>Cell</th><th>Warranty</th>
<th>Qty</th><th>Price</th><th>Payment</th><th>Date & Time</th><th>Action</th>
</tr>
</thead>
<tbody id="salesBody"></tbody>
</table>

</div>

<script>

function selectProduct(name){
productName.value=name;
cellSelect.innerHTML='<option value="">Select Cell</option>';

if(name==="Watch Cell"){
["G1","626","521","721","920","2016","2025","2030","Others"]
.forEach(c=>cellSelect.innerHTML+=`<option>${c}</option>`);
}

if(name==="Titan Cell"){
["626","521","721","920"]
.forEach(c=>cellSelect.innerHTML+=`<option>${c}</option>`);
}
}

function formatIST(dateStr){
return new Date(dateStr).toLocaleString("en-IN",{timeZone:"Asia/Kolkata"});
}

async function addSale(){
const sale={
customerName:customerName.value,
productName:productName.value,
cell:cellSelect.value,
warranty:warrantySelect.value,
quantity:+quantity.value,
price:+price.value,
paymentMethod:paymentMethod.value,
createdDate:saleDate.value
};

await fetch("/sales/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(sale)});
loadSales();
}

async function loadSales(date=null){
const res=await fetch("/sales");
const data=await res.json();

salesBody.innerHTML="";
let count=0,amount=0;

const filter=date||new Date().toLocaleDateString("en-CA",{timeZone:"Asia/Kolkata"});

data.forEach(s=>{
const d=new Date(s.createdDate).toLocaleDateString("en-CA",{timeZone:"Asia/Kolkata"});
if(d===filter){
count++;
amount+=s.price*s.quantity;

salesBody.innerHTML+=`
<tr>
<td>${s.saleId}</td>
<td>${s.customerName||""}</td>
<td>${s.productName}</td>
<td>${s.cell||"-"}</td>
<td>${s.warranty||"-"}</td>
<td>${s.quantity}</td>
<td>₹${s.price}</td>
<td>${s.paymentMethod}</td>
<td>${formatIST(s.createdDate)}</td>
<td>
<button class="print-btn" onclick='printBill(${JSON.stringify(s)})'>Print</button>
<button class="delete-btn" onclick='deleteSale(${s.saleId})'>Delete</button>
</td>
</tr>`;
}
});

count.innerText=count;
amount.innerText=amount;
}

function searchByDate(){loadSales(searchDate.value);}

async function deleteSale(id){
await fetch("/sales/delete/"+id,{method:"DELETE"});
loadSales();
}

function printBill(s){
const w=window.open("");
w.document.write(`<h3>AYAN WATCH & ELECTRONICS</h3>
Customer: ${s.customerName}<br>
Product: ${s.productName}<br>
Cell: ${s.cell||"-"}<br>
Warranty: ${s.warranty||"-"}<br>
Qty: ${s.quantity}<br>
Price: ₹${s.price}<br>
Payment: ${s.paymentMethod}<br>
Date: ${formatIST(s.createdDate)}<br>
<hr>Thank You`);
w.print();
}

document.addEventListener("DOMContentLoaded",loadSales);

</script>

</body>
</html>
